from aiogram import Router
from aiogram.filters import Command, CommandStart
from aiogram.filters.command import CommandObject
from aiogram.fsm.context import FSMContext
from aiogram.types import CallbackQuery, Message

from app.database.requests import (book_training, cancel_booking,
                                   get_trainings, get_user_bookings, set_user)
from app.generators import generate
from app.states import Work

user = Router()


@user.callback_query()
async def handle_callback_query(callback: CallbackQuery):
    if callback.data.startswith("book_"):
        training_id = int(callback.data.split("_")[1])
        success, response = await book_training(
            user_id=callback.from_user.id, training_id=training_id
        )
        await callback.message.answer(response)
    elif callback.data.startswith("cancel_"):
        booking_id = int(callback.data.split("_")[1])
        success = await cancel_booking(
            user_id=callback.from_user.id, booking_id=booking_id
        )
        await callback.message.answer(
            f"–ó–∞–ø–∏—Å—å –Ω–∞ —Ç—Ä–µ–Ω–µ—Ä–æ–≤–∫—É –æ—Ç–º–µ–Ω–µ–Ω–∞."
            if success
            else "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å."
        )
    await callback.answer()


from app.keyboards import bookings_keyboard, schedule_keyboard, user_keyboard


@user.message(CommandStart())
async def register_user(message: Message):
    await set_user(message.from_user.id)
    await message.answer(
        """–ü—Ä–∏–≤–µ—Ç, –≤–æ–∏–Ω!
–¢—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –≤—Å—Ç—Ä–µ—Ç–∏–ª —Å–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–µ–Ω–µ—Ä–∞ AI, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ —Å—Ç–∞—Ç—å —Å–∏–ª—å–Ω–µ–µ, —É–º–Ω–µ–µ –∏ –±—ã—Å—Ç—Ä–µ–µ. üí™

–Ø ‚Äî Coach Orion AI, –∏ –≤–º–µ—Å—Ç–µ —Å —Ç–æ–±–æ–π –º—ã –ø—Ä–æ–π–¥–µ–º –ø—É—Ç—å –∫ –≤–µ–ª–∏—á–∏—é! –í –º–æ–µ–º –∞—Ä—Å–µ–Ω–∞–ª–µ –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ –∑–∞–¥–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç —Ä–∞–∑–≤–∏—Ç—å —Ç–≤–æ–∏ —Å–∏–ª—ã –∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç. –¢—ã –≥–æ—Ç–æ–≤?

–ß—Ç–æ —è —É–º–µ—é:
üí• –¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–∏–ª—É ‚Äî —É–ª—É—á—à–∞–π —Å–≤–æ–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å –ø–æ–º–æ—â—å—é –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º.
üß† –†–∞–∑–≤–∏–≤–∞—Ç—å —É–º—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ ‚Äî –∑–∞–¥–∞–Ω–∏—è –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Ç–≤–æ–µ–≥–æ –º–æ–∑–≥–∞.
‚ö° –î–∞–≤–∞—Ç—å —Å–æ–≤–µ—Ç—ã ‚Äî –Ω–∞ –ª—é–±—É—é —Ç–µ–º—É, –æ—Ç –ª–∏—á–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –¥–æ –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫.

–ì–æ—Ç–æ–≤ –∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º? –î–ª—è –Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ –∫–æ–º–∞–Ω–¥—É –Ω–∏–∂–µ –∏ –Ω–∞—á–Ω–∏ —Å–≤–æ–π –ø—É—Ç—å –∫ —É—Å–ø–µ—Ö—É! üåü
        """,
        reply_markup=user_keyboard,
    )


@user.message(lambda message: message.text == "üí™ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É")
async def view_schedule(message: Message):
    trainings = await get_trainings()
    if trainings:
        await message.answer(
            "–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:", reply_markup=schedule_keyboard(trainings)
        )
    else:
        await message.answer("–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç.")


@user.message(lambda message: message.text == "üò• –û—Ç–º–µ–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É")
async def my_bookings_handler(message: Message):
    bookings = await get_user_bookings(user_id=message.from_user.id)
    if bookings:
        await message.answer(
            "–í–∞—à–∏ –∑–∞–ø–∏—Å–∏:", reply_markup=bookings_keyboard(bookings)
        )
    else:
        await message.answer("–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.")


@user.message(lambda message: message.text == "‚ö° –°–æ–≤–µ—Ç—ã –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏")
async def generate_training_tip(message: Message, state: FSMContext):
    prompt = """–¢—ã ‚Äî —Ç—Ä–µ–Ω–µ—Ä AI –ø–æ –∏–º–µ–Ω–∏ **Coach Orion**. –¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª –≤ –æ–±–ª–∞—Å—Ç–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä—ã. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –¥–µ–ª–∏—Ç—å—Å—è –ø–æ–ª–µ–∑–Ω—ã–º–∏, –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏ –∏ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, —É–ª—É—á—à–µ–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π —Ñ–æ—Ä–º—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π. –¢—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—à—å –¥–µ–ª–∏—Ç—å—Å—è –∑–∞–±–∞–≤–Ω—ã–º–∏ —Ñ–∞–∫—Ç–∞–º–∏ –∏–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π, —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å —Ñ–∏—Ç–Ω–µ—Å–æ–º, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º. –¢—ã ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç—Ä–µ–Ω–µ—Ä, —Ç—ã ‚Äî –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –Ω–∞ –ø—É—Ç–∏ –∫ –≤–µ–ª–∏—á–∏—é!

        –í–æ—Ç –ø—Ä–∏–º–µ—Ä—ã –∑–∞–±–∞–≤–Ω—ã—Ö –∏ –ø–æ–ª–µ–∑–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ Coach Orion AI –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
    "–ê –≤—ã –∑–Ω–∞–ª–∏, —á—Ç–æ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ —É–ª—É—á—à–∏—Ç—å –≥–∏–±–∫–æ—Å—Ç—å ‚Äî —ç—Ç–æ –π–æ–≥–∞ —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–≥–µ? ü¶∂ –û–Ω–∞ –ø–æ–º–æ–≥–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Ç—è–Ω—É—Ç—å –º—ã—à—Ü—ã, –Ω–æ –∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é. –¢–∞–∫ —á—Ç–æ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –∑–∞—Ö–æ—Ç–∏—Ç–µ —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∞–Ω–∏–º–∞—Ç—å—Å—è –π–æ–≥–æ–π ‚Äî –∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —É–∫—Ä–µ–ø–∏—Ç—å —Å–≤–æ—é —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å!"
    "–ü–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ, –ª—é–¥–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–Ω–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ, —á—É–≤—Å—Ç–≤—É—é—Ç —Å–µ–±—è –±–æ–ª–µ–µ —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–º–∏ –∏ –¥–æ–≤–æ–ª—å–Ω—ã–º–∏, —á–µ–º —Ç–µ, –∫—Ç–æ —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç—Å—è –≤ –ø–æ–º–µ—â–µ–Ω–∏–∏. üåø –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ö–æ—Ç—è –±—ã —Ä–∞–∑ –≤—ã–π—Ç–∏ –Ω–∞ —É—Ç—Ä–µ–Ω–Ω—é—é –ø—Ä–æ–±–µ–∂–∫—É –∏ –ø–æ—á—É–≤—Å—Ç–≤—É–π—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É ‚Äî –ø—Ä–∏—Ä–æ–¥–∞ –¥–µ–ª–∞–µ—Ç –≤–∞—Å —Å–∏–ª—å–Ω–µ–µ!"
    "–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É—Å–∫–æ—Ä–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–µ—Ö–Ω–∏–∫—É '–ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è'. –≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Ä–∞—Å—Ç—è–∂–∫—É, —Å–ø–æ–∫–æ–π–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ –∏ —á–∞—à–∫—É –∑–µ–ª–µ–Ω–æ–≥–æ —á–∞—è. üçµ –î–∞, —Ç–∞–∫–æ–π –ø—Ä–æ—Å—Ç–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–º–æ–∂–µ—Ç –≤–∞—à–µ–º—É —Ç–µ–ª—É –±—ã—Å—Ç—Ä–µ–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Ñ–æ—Ä–º—É!"
    "–ó–Ω–∞–µ—Ç–µ –ª–∏ –≤—ã, —á—Ç–æ —Å–º–µ—Ö ‚Äî —ç—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞ –∏ —É–ª—É—á—à–∏—Ç—å –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ? üòÇ –¢–∞–∫ —á—Ç–æ –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ —Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–µ–¥–∏–π–Ω—ã–µ —à–æ—É –ø–æ—Å–ª–µ —Ç—è–∂–µ–ª–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏. –≠—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞–∑–≤–µ—Å–µ–ª–∏—Ç –≤–∞—Å, –Ω–æ –∏ –ø–æ–º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è!"
    "–ê –≤—ã –∑–Ω–∞–ª–∏, —á—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —Å–∏–ª—É –∑–∞—Ö–≤–∞—Ç–∞ —Å –ø–æ–º–æ—â—å—é –±–∞–Ω–∞–Ω–æ–≤–æ–≥–æ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞? üçå –ù–µ—Ç, —ç—Ç–æ –Ω–µ —à—É—Ç–∫–∞! –ü—Ä–æ—Å—Ç–æ –¥–µ—Ä–∂–∏—Ç–µ –±–∞–Ω–∞–Ω –∑–∞ –∫–æ–Ω—Ü—ã –∏ —Å–∂–∏–º–∞–π—Ç–µ –µ–≥–æ –∫–∞–∫ —Ç—Ä–µ–Ω–∞–∂–µ—Ä –¥–ª—è –∫–∏—Å—Ç–µ–π ‚Äî –Ω–µ–æ–±—ã—á–Ω–æ, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ!"
    "–ü–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º, –≤–µ—á–µ—Ä–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ–º–æ–≥–∞—é—Ç —É–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞! üåô –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –≤–∞–º —Ç—è–∂–µ–ª–æ –∑–∞—Å–Ω—É—Ç—å, –≤–æ–∑–º–æ–∂–Ω–æ, –≤–µ—á–µ—Ä–Ω—è—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ‚Äî —ç—Ç–æ —Ç–æ, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ. –ö–æ–Ω–µ—á–Ω–æ, –Ω–µ —Å—Ç–æ–∏—Ç –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–µ–±—è –ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º, –Ω–æ –ª–µ–≥–∫–æ–µ –∫–∞—Ä–¥–∏–æ —Å–¥–µ–ª–∞–µ—Ç —Å–≤–æ–µ –¥–µ–ª–æ."
    "–ó–Ω–∞–µ—Ç–µ –ª–∏ –≤—ã, —á—Ç–æ –ø—Ä–æ—Å—Ç–æ–µ —Å–∏–¥–µ–Ω–∏–µ –Ω–∞ –º—è—á–∏–∫–µ –¥–ª—è —Ñ–∏—Ç–Ω–µ—Å–∞ –ø–æ–º–æ–≥–∞–µ—Ç —É–ª—É—á—à–∏—Ç—å –æ—Å–∞–Ω–∫—É –∏ —É–∫—Ä–µ–ø–∏—Ç—å –º—ã—à—Ü—ã –∫–æ—Ä–∞? üèê –ù–∞—á–Ω–∏—Ç–µ —Å–∏–¥–µ—Ç—å –Ω–∞ –Ω–µ–º –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∑–∞ —Å—Ç–æ–ª–æ–º ‚Äî —ç—Ç–æ —Å–¥–µ–ª–∞–µ—Ç –≤–∞—à—É —Å–ø–∏–Ω—É —Å–∏–ª—å–Ω–µ–µ –∏ –ø–æ–º–æ–∂–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –±–æ–ª–µ–π!" 
    "–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ, –¥–æ–±–∞–≤—å—Ç–µ –≤ —Å–≤–æ—é –ø—Ä–æ–≥—Ä–∞–º–º—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å —É—Å–∫–æ—Ä–µ–Ω–∏—è–º–∏. –ù–∞—á–Ω–∏—Ç–µ —Å –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–ø—Ä–∏–Ω—Ç–æ–≤ –ø–æ 10-20 —Å–µ–∫—É–Ω–¥. –≠—Ç–æ —É–ª—É—á—à–∏—Ç –≤–∞—à—É —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –±—ã—Ç—å –Ω–∞ —à–∞–≥ –≤–ø–µ—Ä–µ–¥–∏!"

–ú–∞–∫—Å–∏–º—É–º 1-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –º–æ–∂–µ—à—å —Å–º–∞–π–ª–∏–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å
–ù–∞—á–∏–Ω–∞–π –æ—Ç–≤–µ—Ç —Å—Ä–∞–∑—É —Å —Å–æ–≤–µ—Ç–∞, —Ñ–∞–∫—Ç–∞, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏. 

        """
    response = await generate(prompt)

    await message.answer(response.choices[0].message.content)


@user.message(Work.process)
async def stop(message: Message):
    await message.answer("–ü–æ–¥–æ–∂–¥–∏—Ç–µ, –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è...")


@user.message(Command("book"))
async def book(message: Message, command: CommandObject):
    if not command.args:
        await message.answer("–£–∫–∞–∂–∏—Ç–µ ID —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏. –ü—Ä–∏–º–µ—Ä: /book 1")
        return
    try:
        training_id = int(command.args)
        success, response = await book_training(
            user_id=message.from_user.id, training_id=training_id
        )
        await message.answer(response)
    except ValueError:
        await message.answer(
            "–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏. –ü—Ä–∏–º–µ—Ä: /book 1"
        )


@user.message(Command("cancel"))
async def cancel(message: Message, command: CommandObject):
    if not command.args:
        await message.answer("–£–∫–∞–∂–∏—Ç–µ ID —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏. –ü—Ä–∏–º–µ—Ä: /cancel 1")
        return
    try:
        training_id = int(command.args)
        success = await cancel_booking(
            user_id=message.from_user.id, training_id=training_id
        )
        await message.answer(
            f"–í—ã —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–∏–ª–∏ –∑–∞–ø–∏—Å—å –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É ID {training_id}."
            if success
            else "–í—ã –Ω–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ —ç—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É."
        )
    except ValueError:
        await message.answer(
            "–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏. –ü—Ä–∏–º–µ—Ä: /cancel 1"
        )


@user.message(Command("help"))
async def help_command(message: Message):
    commands = (
        "/start ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n"
        "/view_schedule ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.\n"
        "/my_bookings ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n"
        "/book [id —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏] ‚Äî –∑–∞–ø–∏—Å—å –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É.\n"
        "/cancel [id —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏] ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É.\n"
        "/help ‚Äî –ø–æ–º–æ—â—å –ø–æ —Ä–∞–±–æ—Ç–µ —Å –±–æ—Ç–æ–º."
    )
    await message.answer(f"–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n{commands}")


@user.message(lambda message: message.text == "üó£ –ü–æ–æ–±—â–∞—Ç—å—Å—è —Å —Ç—Ä–µ–Ω–µ—Ä–æ–º")
async def ai(message: Message, state: FSMContext):
    await state.set_state(Work.process)
    response = await generate(message.text)
    await message.answer(response.choices[0].message.content)
    await state.clear()


@user.message()
async def ai(message: Message, state: FSMContext):
    await state.set_state(Work.process)

    prompt = (
        "–¢—ã ‚Äî —Ç—Ä–µ–Ω–µ—Ä AI –ø–æ –∏–º–µ–Ω–∏ **Coach Orion**. –¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª –≤ –æ–±–ª–∞—Å—Ç–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä—ã. "
        "–û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫."
    )

    response = await generate(prompt + "\n" + message.text)
    await message.answer(response.choices[0].message.content)

    await state.clear()
